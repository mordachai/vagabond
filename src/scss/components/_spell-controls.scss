// -----------------------------------------
// Spell Casting Controls
// -----------------------------------------
// Styles for inline spell casting controls in favorited spells section

// Spells section title with mana display
.weapon-skills h4 {
  display: flex;
  align-items: center;
  gap: 6px;

  .mana-icon {
    font-size: 12px;
    color: $c-tan;
    margin-left: 4px;
  }

  .mana-display {
    font-size: 13px;
    font-weight: 600;
    color: $c-dark;
    font-family: $font-secondary;

    .mana-current {
      &.mana-modifier {
        cursor: pointer;
        padding: 2px 4px;
        border-radius: 3px;
        transition: background-color 0.2s, color 0.2s;

        &:hover {
          background-color: rgba(212, 175, 55, 0.15);
          color: $c-red;
        }
      }
    }
  }
}

.favorited-spell {
  display: flex;
  flex-direction: column;
  width: 100%;
  margin-bottom: 2px;
  
  // Accordion state
  &.collapsed .spell-accordion-content {
    display: none;
  }

  // Trigger Row (Grid)
  .spell-trigger {
    display: grid;
    grid-template-columns: 20px 3fr 1fr 25px;
    gap: 4px;
    align-items: flex-end;
    width: 100%;
    padding: 2px 0;
    border-radius: 3px;
    transition: background-color 0.2s;
    font-size: 1.2em;
    position: relative;
    margin: 0 2px;
    
    &:hover {
      background-color: rgba(0, 0, 0, 0.02);
    }
    
    // Col 1: Icon (Rolls)
    .spell-icon-trigger {
      display: flex;
      justify-content: center;
      align-self: center;
      cursor: pointer;
      position: relative;
      z-index: 5;
      
      // Frame styling
      width: 20px;
      height: 20px;
      border: 2px solid $c-dark-bluey; // Default Closed
      border-radius: 2px;
      overflow: hidden;
      transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
      background: transparent;

      img {
        border: none;
        width: 100%;
        height: 100%;
        object-fit: cover;
        filter: sepia(0.2);
        transition: filter 0.2s, transform 0.3s ease;
      }
      
      &:hover {
        border-color: $c-yellow; // Hover Color
        box-shadow: 0 0 1px $c-tan;
        
        img {
          filter: sepia(0);
        }
      }
      
      &:active img {
        transform: scale(0.9);
      }
    }

    // Open State Behavior
    @at-root .favorited-spell:not(.collapsed) .spell-trigger {
       .spell-icon-trigger {
         border-color: $c-yellow;
         transform: translateY(50%) rotate(45deg) scale(1.65);
         z-index: 10;
          margin-left: 12px;

         img {
           transform: rotate(-45deg) scale(1.4);
           filter: sepia(0);
         }
       }
    }

    // Col 2: Name + Damage Icon (Accordion Toggle)
    .spell-name-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      cursor: pointer;
      transition: padding-left 0.3s ease;
      
      &:hover .spell-name {
        color: $c-red;
        text-shadow: 0 0 2px rgba(212, 175, 55, 0.3);
      }

      .spell-name {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        font-family: $font-title;
        color: $c-dark;
        text-align: left;
      }
      
      .spell-damage-type-icon {
        display: flex;
        justify-content: center;
        align-items: center;
        
        i {
            color: $c-dark;
            font-size: 0.9em;
            opacity: 0.8;
        }

        // &::after,
        // &::before {content: '-'; font-size: 0.8em;}
      }
    }

    // Col 3: Damage Display (Modifies Damage)
    .spell-damage-trigger {
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: $font-title;
      color: $c-dark;
      font-size: 1em;
      cursor: pointer;
      
      &:hover {
        color: $c-red;
      }
      
      .damage-placeholder {
        color: rgba(0,0,0,0.3);
      }
    }
    
    // Col 4: Mana Cost
    .spell-mana-total {
      text-align: center;
      font-family: $font-secondary;
      color: $c-red;
      cursor: pointer;
      
      &:hover {
        text-shadow: 0 0 2px $c-red;
      }
    }
  }

  // Accordion Content
  .spell-accordion-content {
    width: 100%;
    padding: 0 0 2px 5px;
    margin-bottom: 4px;
    animation: fadein 0.2s ease-in-out;
    color: $c-white;
    
    .accordion-inner-grid {
      // Offset to match middle columns of trigger (30px + 4px gap)
      margin-left: 19px;
      margin-right: 25px;
      
      display: grid;
      // 4 columns: 2fr, 1fr, 30px, 1fr
      grid-template-columns: 3fr 1fr 1fr 1fr;
      gap: 4px;
      align-items: baseline;
      padding: 2px 4px;

      background-color: $c-dark-bluey;
      border-top: 2px solid $c-yellow;

      
      // Col 1: Delivery Select
      .delivery-select-wrapper {
        width: 100%;
         
         .spell-delivery-select {
             width: 100%;
             min-width: 75px;
             border: none;
             border-bottom: 1px solid rgba(0,0,0,0.1);
             background: transparent;
             font-family: $font-title;
             font-size: 0.9em;
             text-transform: uppercase;
             padding: 0;
             padding-left: 12px;
             height: 1.1em !important;
             color: $c-white;
          
             &:focus { outline: none; border-bottom-color: $c-red; }
         }
      }
      
      // Col 2: Delivery Cost
      .spell-delivery-cost {
         width: 100%;
         text-align: center;
         font-weight: bold;
         
         &.clickable:hover { color: $c-red; background: rgba(0,0,0,0.05); }
         &.disabled { opacity: 0.5; }
      }
      
      // Col 3: Range
      .spell-range {
          text-align: center;
          
          &.preview-active {
            color: $c-red;
            text-shadow: 0 0 2px $c-red;
          }
      }
      
      // Col 4: Fx Toggle
      .spell-fx-icon {
          display: flex;
          justify-content: center;
          cursor: pointer;
          
          &.fx-active { color: $c-yellow; font-weight: 600; }
          &.fx-inactive { opacity: 0.4; }
          
          &:hover { opacity: 1; }
      }
    }
  }
}

.weapon-skills {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 0;
}

.favorited-spells-list {
  flex: 1;
  min-height: 0;
  overflow-y: auto;
  overflow-x: hidden;
  scrollbar-width: thin;
  padding-right: 2px;
  
  /* Webkit scrollbar styling */
  &::-webkit-scrollbar {
    width: 4px;
  }
  
  &::-webkit-scrollbar-track {
    background: transparent;
  }
  
  &::-webkit-scrollbar-thumb {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 4px;
  }
  
  &::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 0, 0, 0.2);
  }
}

@keyframes fadein {
  from { opacity: 0; transform: translateY(-5px); }
  to { opacity: 1; transform: translateY(0); }
}

// Chat card styling for spell casts
.vagabond-spell-cast {
  h3 {
    margin: 0 0 10px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    padding-bottom: 5px;
  }

  p {
    margin: 5px 0;
  }

  strong {
    color: var(--vagabond-c-tan, #d4af37);
  }
}

// Note: Damage button styling is now in components/chat-cards.scss
