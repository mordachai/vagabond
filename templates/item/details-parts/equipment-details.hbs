{{! Unified Equipment Details Tab - Switches between locked/unlocked views }}
<section
  class='tab details {{tab.cssClass}} {{#if system.locked}}equipment-locked-view{{/if}}'
  data-group='primary'
  data-tab='details'
>
  {{#if system.locked}}
    {{! ===== LOCKED VIEW ===== }}
    <div class='equipment-locked-content'>
      {{! Description - Always show if present }}
      {{#if system.description}}
        <div class='locked-section'>
          <div class='locked-description'>
            {{{enriched.description}}}
          </div>
        </div>
      {{/if}}

      {{! Two-column layout: Main content | Details }}
      <div class='locked-two-column'>
        <div class='locked-column-left'>
          {{! ===== WEAPON-SPECIFIC DISPLAY ===== }}
      {{#if (eq system.equipmentType 'weapon')}}
        <div class='locked-section'>
          <h3 class='section-header'>{{localize "VAGABOND.UI.Sections.WeaponStats"}}</h3>
          <div class='locked-stats-grid'>
            <div class='locked-stat'>
              <span class='stat-label'>{{localize "VAGABOND.UI.Labels.SkillColon"}}</span>
              <span class='stat-value'>{{localize (lookup config.weaponSkills system.weaponSkill)}}</span>
            </div>
            <div class='locked-stat'>
              <span class='stat-label'>{{localize "VAGABOND.UI.Labels.RangeColon"}}</span>
              <span class='stat-value'>{{system.range}}</span>
            </div>
            <div class='locked-stat'>
              <span class='stat-label'>{{localize "VAGABOND.UI.Labels.GripColon"}}</span>
              <span class='stat-value'>{{system.gripDisplay}}</span>
            </div>
            <div class='locked-stat'>
              <span class='stat-label'>{{localize "VAGABOND.UI.Labels.DamageOneHandColon"}}</span>
              <span class='stat-value'>{{system.damageOneHand}} {{localize (lookup config.damageTypes system.damageTypeOneHand)}}</span>
            </div>
            {{#if (or (eq system.grip '2H') (eq system.grip 'V'))}}
              <div class='locked-stat'>
                <span class='stat-label'>{{localize "VAGABOND.UI.Labels.DamageTwoHandColon"}}</span>
                <span class='stat-value'>{{system.damageTwoHands}} {{localize (lookup config.damageTypes system.damageTypeTwoHands)}}</span>
              </div>
            {{/if}}
            {{#if system.canExplode}}
              <div class='locked-stat'>
                <span class='stat-label'>{{localize "VAGABOND.UI.Labels.CanExplodeColon"}}</span>
                <span class='stat-value'>{{system.explodeValues}}</span>
              </div>
            {{/if}}
          </div>

          {{#if system.properties.length}}
            <div class='locked-properties'>
              <span class='stat-label'>Properties:</span>
              <div class='property-tags-locked'>
                {{#each system.properties as |property|}}
                  <span data-tooltip='{{lookup ../config.weaponPropertyHints key}}'>{{localize label}}</span>                    {{property}}
                  </span>
                {{/each}}
              </div>
            </div>
          {{/if}}
        </div>
      {{/if}}

      {{! ===== ARMOR-SPECIFIC DISPLAY ===== }}
      {{#if (eq system.equipmentType 'armor')}}
        <div class='locked-section'>
          <h3 class='section-header'>{{localize "VAGABOND.UI.Sections.ArmorStats"}}</h3>
          <div class='locked-stats-grid'>
            <div class='locked-stat'>
              <span class='stat-label'>Type:</span>
              <span class='stat-value'>{{system.armorTypeDisplay}}</span>
            </div>
            <div class='locked-stat'>
              <span class='stat-label'>Rating:</span>
              <span class='stat-value'>{{system.finalRating}}</span>
            </div>
            <div class='locked-stat'>
              <span class='stat-label'>Might Req:</span>
              <span class='stat-value'>{{system.might}}</span>
            </div>
            {{! Damage Immunities (Read-Only) }}
            {{#if system.immunities.length}}
              <div class='locked-stat'>
                <span class='stat-label'>Immunities:</span>
                <span class='stat-value'>
                  {{#each system.immunities as |immunity index|}}{{immunity}}{{#unless @last}}, {{/unless}}{{/each}}
                </span>
              </div>
            {{/if}}
          </div>
        </div>
      {{/if}}

      {{! ===== GEAR-SPECIFIC DISPLAY ===== }}
      {{#if (eq system.equipmentType 'gear')}}
        {{#if system.gearCategory}}
          <div class='locked-section'>
            <div class='locked-stat'>
              <span class='stat-label'>Category:</span>
              <span class='stat-value'>{{system.gearCategory}}</span>
            </div>
          </div>
        {{/if}}
      {{/if}}

      {{! ===== ALCHEMICAL-SPECIFIC DISPLAY ===== }}
      {{#if (eq system.equipmentType 'alchemical')}}
        <div class='locked-section'>
          <h3 class='section-header'>{{localize "VAGABOND.UI.Sections.Alchemical"}}</h3>
          <div class='locked-stats-grid'>
            <div class='locked-stat'>
              <span class='stat-label'>Type:</span>
              <span class='stat-value'>{{localize (concat "VAGABOND.Item.Alchemical.Types." (capitalize system.alchemicalType))}}</span>
            </div>
            {{#unless (eq system.damageType '-')}}
              <div class='locked-stat'>
                <span class='stat-label'>Damage:</span>
                <span class='stat-value'>{{system.damageAmount}} {{localize (concat "VAGABOND.DamageTypes." (capitalize system.damageType))}}</span>
              </div>
              {{#if system.canExplode}}
                <div class='locked-stat'>
                  <span class='stat-label'>Can Explode:</span>
                  <span class='stat-value'>{{system.explodeValues}}</span>
                </div>
              {{/if}}
            {{/unless}}
            <div class='locked-stat'>
              <span class='stat-label'>Cost:</span>
              <span class='stat-value'>{{system.costDisplay}}</span>
            </div>
          </div>
        </div>
      {{/if}}

      {{! ===== RELIC-SPECIFIC DISPLAY ===== }}
      {{#if (eq system.equipmentType 'relic')}}
        <div class='locked-section'>
          <h3 class='section-header'>{{localize "VAGABOND.UI.Sections.Relic"}}</h3>
          {{#if system.lore}}
            <div class='locked-text-block'>
              <span class='stat-label'>{{localize 'VAGABOND.Item.Relic.FIELDS.lore.label'}}:</span>
              <p>{{system.lore}}</p>
            </div>
          {{/if}}
          <div class='locked-stats-grid'>
            <div class='locked-stat'>
              <span class='stat-label'>{{localize 'VAGABOND.Item.Relic.FIELDS.baseCost.label'}}:</span>
              <span class='stat-value'>{{system.costDisplay}}</span>
            </div>
          </div>
        </div>
      {{/if}}

      {{! ===== UNIVERSAL FIELDS ===== }}

          {{! Damage/Healing if present }}
          {{#unless (eq system.damageType '-')}}
            <div class='locked-section'>
              <h3 class='section-header'>{{#if (eq system.damageType 'healing')}}{{localize "VAGABOND.UI.Sections.Healing"}}{{else}}{{localize "VAGABOND.UI.Sections.Damage"}}{{/if}}</h3>
              <div class='locked-stats-grid'>
                <div class='locked-stat'>
                  <span class='stat-label'>Type:</span>
                  <span class='stat-value'>{{localize (lookup config.damageTypes system.damageType)}}</span>
                </div>
                {{#if system.damageAmount}}
                  <div class='locked-stat'>
                    <span class='stat-label'>Amount:</span>
                    <span class='stat-value'>{{system.damageAmount}}</span>
                  </div>
                {{/if}}
                {{#if system.canExplode}}
                  <div class='locked-stat'>
                    <span class='stat-label'>Can Explode:</span>
                    <span class='stat-value'>{{system.explodeValues}}</span>
                  </div>
                {{/if}}
              </div>
            </div>
          {{/unless}}
        </div>

        {{! Right column - Equipment Details }}
        <div class='locked-column-right'>
          <div class='locked-section'>
            <h3 class='section-header'>{{localize "VAGABOND.UI.Sections.Details"}}</h3>
            <div class='locked-stats-grid'>
              {{#unless (eq system.metal 'none')}}
                <div class='locked-stat'>
                  <span class='stat-label'>Metal:</span>
                  <span class='stat-value' data-tooltip='{{system.metalEffect}}'>{{system.metalDisplay}}</span>
                </div>
              {{/unless}}
              <div class='locked-stat'>
                <span class='stat-label'>Slots:</span>
                <span class='stat-value'>{{system.slots}}</span>
              </div>
              {{#if (gt system.quantity 1)}}
                <div class='locked-stat'>
                  <span class='stat-label'>Quantity:</span>
                  <span class='stat-value'>{{system.quantity}}</span>
                </div>
              {{/if}}
              <div class='locked-stat'>
                <span class='stat-label'>Cost:</span>
                <span class='stat-value'>{{system.costDisplay}}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  {{else}}
    {{! ===== UNLOCKED VIEW (EDITABLE) ===== }}
    <div class='equipment-item-content'>
      {{! Description Section - Universal }}
      <div class='form-group'>
        <label class='resource-label'>{{localize 'VAGABOND.Item.base.FIELDS.description.label'}}</label>
        <div class='equipment-description'>
          {{#if editable}}
            <prose-mirror name="system.description" data-document-uuid="{{item.uuid}}" value="{{system.description}}" collaborate="true" toggled="true">
              {{{enriched.description}}}
            </prose-mirror>
          {{else}}
            <div>{{{enriched.description}}}</div>
          {{/if}}
        </div>
      </div>

      {{! ===== WEAPON-SPECIFIC FIELDS ===== }}
      {{#if (eq system.equipmentType 'weapon')}}
        {{! Weapon Skill and Damage Row }}
        <div class='form-group'>
          <label class='resource-label'>Weapon Configuration</label>
          <div class='grid grid-3col gap-8'>
            <div class='weapon-skill-field'>
              <label class='resource-label'>Skill</label>
              {{> "systems/vagabond/templates/shared/weapon-skill-select.hbs"
                  name="system.weaponSkill"
                  selected=system.weaponSkill
                  config=config}}
            </div>
            <div class='weapon-range-field'>
              <label class='resource-label'>Range</label>
              <select name="system.range" data-dtype="String">
                  {{selectOptions config.weaponRanges selected=system.range localize=true blank="-"}}
              </select>
            </div>
            <div class='weapon-grip-field'>
              <label class='resource-label'>Grip</label>
              <select name="system.grip" data-dtype="String" data-action="update-grip">
                  {{selectOptions config.grip selected=system.grip localize=true}}
              </select>
            </div>
          </div>
        </div>

        {{! Weapon Damage Fields }}
        <div class='form-group'>
          <label class='resource-label'>Damage</label>
          <div class='grid grid-2col gap-8'>
            <div class='damage-with-icon'>
              <label class='resource-label'><i class='fas fa-hand-fist'></i> One Hand - Amount</label>
              <input
                type='text'
                name='system.damageOneHand'
                value='{{system.damageOneHand}}'
                data-dtype='String'
                placeholder='d8'
              />
            </div>
            <div class='damage-with-icon'>
              <label class='resource-label'><i class='fas fa-hand-fist'></i> One Hand - Type</label>
              {{> "systems/vagabond/templates/shared/damage-type-select.hbs"
                  name="system.damageTypeOneHand"
                  selected=system.damageTypeOneHand
                  includeNone=true
                  config=config}}
            </div>
          </div>
          <div class='grid grid-2col gap-8'>
            <div class='damage-with-icon'>
              <label class='resource-label'><i class='fas fa-hands'></i> Two Hands - Amount</label>
              <input
                type='text'
                name='system.damageTwoHands'
                value='{{system.damageTwoHands}}'
                data-dtype='String'
                placeholder='d10'
                {{#unless (or (eq system.grip '2H') (eq system.grip 'V'))}}disabled{{/unless}}
              />
            </div>
            <div class='damage-with-icon'>
              <label class='resource-label'><i class='fas fa-hands'></i> Two Hands - Type</label>
              {{#if (or (eq system.grip '2H') (eq system.grip 'V'))}}
                {{> "systems/vagabond/templates/shared/damage-type-select.hbs"
                    name="system.damageTypeTwoHands"
                    selected=system.damageTypeTwoHands
                    includeNone=true
                    config=config}}
              {{else}}
                <select name="system.damageTypeTwoHands" data-dtype="String" disabled>
                  <option value="{{system.damageTypeTwoHands}}">{{localize (lookup config.damageTypes system.damageTypeTwoHands)}}</option>
                </select>
              {{/if}}
            </div>
          </div>
        </div>

        {{! Exploding Dice Configuration }}
        <div class='form-group'>
          <label class='resource-label'>Exploding Dice</label>
          <div class='grid grid-2col gap-8'>
            <div class='explode-checkbox-field'>
              <label class='checkbox-label'>
                <input
                  type='checkbox'
                  name='system.canExplode'
                  {{#if system.canExplode}}checked{{/if}}
                  data-dtype='Boolean'
                />
                <span>Can Explode</span>
              </label>
            </div>
            <div class='explode-values-field'>
              <label class='resource-label'>Explode On (comma-separated)</label>
              <input
                type='text'
                name='system.explodeValues'
                value='{{system.explodeValues}}'
                data-dtype='String'
                placeholder='e.g., 1,4'
                {{#unless system.canExplode}}disabled{{/unless}}
              />
            </div>
          </div>
        </div>

        {{! Weapon Properties }}
        <div class='form-group'>
          <label class='resource-label'>{{localize 'VAGABOND.Item.Weapon.FIELDS.properties.label'}}</label>
          <div class='property-selector-row'>
          <details class='property-dropdown'>
            <summary class='property-dropdown-toggle'>
              <i class='fas fa-chevron-down'></i>
              <span>Select Properties</span>
            </summary>
            <div class='property-checkboxes'>
              
              {{#each config.weaponProperties as |label key|}}
              <label class='property-checkbox-item'>
                <input 
                  type='checkbox' 
                  value='{{key}}' 
                  {{#if (contains system.properties key)}}checked{{/if}} 
                  data-action='toggleWeaponProperty' 
                  data-property='{{key}}'
                >
                <span data-tooltip='{{lookup config.weaponPropertyHints key}}'>{{localize label}}</span>
              </label>
              {{/each}}
              
            </div>
          </details>
            <div class='property-tags'>
              {{#each system.properties as |property index|}}
                <span class='property-tag' data-tooltip='{{lookup config.weaponPropertyHints property}}'>
                  {{property}}
                  <i class='fas fa-times' data-action='removeWeaponProperty' data-property='{{property}}'></i>
                </span>
              {{/each}}
            </div>
          </div>
        </div>
      {{/if}}

      {{! ===== ARMOR-SPECIFIC FIELDS ===== }}
      {{#if (eq system.equipmentType 'armor')}}
        {{! Armor Type }}
        <div class='form-group'>
          <label class='resource-label'>Armor Configuration</label>
          <div class='grid grid-1col'>
            <div class='armor-type-field'>
              <label class='resource-label'>Armor Type</label>
              <select name='system.armorType' data-dtype='String'>
                  {{selectOptions config.armorTypeDescriptions selected=system.armorType}}
              </select>
            </div>
          </div>
        </div>

        {{! Calculated Armor Properties }}
        <div class='form-group'>
          <label class='resource-label'>Armor Properties</label>
          <div class='calculated-properties'>
            <div class='calculated-item'>
              <span class='calc-label'>Rating:</span>
              <span class='calc-value'>{{system.finalRating}}</span>
            </div>
            <div class='calculated-item'>
              <span class='calc-label'>Might Requirement:</span>
              <span class='calc-value'>{{system.might}}</span>
            </div>
          </div>
        </div>

        {{! Damage Immunities }}
        <div class='form-group'>
          <details class='npc-immunity-dropdown'>
            <summary class='npc-immunity-toggle'>
              <i class='fas fa-chevron-down'></i>
              <span>Damage Immunities</span>
            </summary>
            <div class='npc-immunity-checkboxes'>
              {{#each config.damageTypes as |label key|}}
                {{#unless (eq key '-')}}
                  <label class='npc-immunity-checkbox-item'>
                    <input type='checkbox' value='{{key}}' {{#if (contains ../system.immunities key)}}checked{{/if}} data-action='toggleImmunity' data-immunity='{{key}}'>
                    <span>{{localize label}}</span>
                  </label>
                {{/unless}}
              {{/each}}
            </div>
          </details>
          <div class='npc-immunity-tags'>
            {{#each system.immunities as |immunity index|}}
              <span class='npc-immunity-tag'>
                {{immunity}}
                <i class='fas fa-times' data-action='removeImmunity' data-immunity='{{immunity}}'></i>
              </span>
            {{/each}}
          </div>
        </div>
      {{/if}}

      {{! ===== GEAR-SPECIFIC FIELDS ===== }}
      {{#if (eq system.equipmentType 'gear')}}
        {{! Gear Category }}
        <div class='form-group'>
          <label class='resource-label'>Gear Category</label>
          <input
            type='text'
            name='system.gearCategory'
            value='{{system.gearCategory}}'
            data-dtype='String'
            placeholder='e.g., Alchemy & Medicine'
          />
        </div>
      {{/if}}

      {{! ===== ALCHEMICAL-SPECIFIC FIELDS ===== }}
      {{#if (eq system.equipmentType 'alchemical')}}
        {{! Alchemical Type }}
        <div class='form-group'>
          <label class='resource-label'>{{localize 'VAGABOND.Item.Alchemical.FIELDS.alchemicalType.label'}}</label>
          <select name='system.alchemicalType' data-dtype='String'>
            
            {{#each config.alchemicalTypes as |label key|}}
              <option 
                value="{{key}}" 
                {{#if (eq ../system.alchemicalType key)}}selected{{/if}}
                title="{{localize (lookup ../config.alchemicalTypeHints key)}}"
              >
                {{localize label}}
              </option>
            {{/each}}

          </select>
        </div>

        {{! Damage Type and Amount }}
        <div class='form-group'>
          <label class='resource-label'>Damage</label>
          <div class='grid grid-2col gap-8'>
            <div class='damage-type-field'>
              <label class='resource-label'>{{localize 'VAGABOND.Item.Alchemical.FIELDS.damageType.label'}}</label>
              {{> "systems/vagabond/templates/shared/damage-type-select.hbs" 
                  name="system.damageType" 
                  selected=system.damageType 
                  includeNone=true 
                  config=config}}
            </div>
            <div class='damage-amount-field'>
              <label class='resource-label'>{{localize 'VAGABOND.Item.Alchemical.FIELDS.damageAmount.label'}}</label>
              <input
                type='text'
                name='system.damageAmount'
                value='{{system.damageAmount}}'
                data-dtype='String'
                placeholder='e.g., 2d6'
              />
            </div>
          </div>
        </div>

        {{! Exploding Dice Configuration }}
        <div class='form-group'>
          <label class='resource-label'>Exploding Dice</label>
          <div class='grid grid-2col gap-8'>
            <div class='explode-checkbox-field'>
              <label class='checkbox-label'>
                <input
                  type='checkbox'
                  name='system.canExplode'
                  {{#if system.canExplode}}checked{{/if}}
                  data-dtype='Boolean'
                />
                <span>Can Explode</span>
              </label>
            </div>
            <div class='explode-values-field'>
              <label class='resource-label'>Explode On (comma-separated)</label>
              <input
                type='text'
                name='system.explodeValues'
                value='{{system.explodeValues}}'
                data-dtype='String'
                placeholder='e.g., 1,4'
                {{#unless system.canExplode}}disabled{{/unless}}
              />
            </div>
          </div>
        </div>

        {{! Cost }}
        <div class='form-group'>
          <label class='resource-label'>{{localize 'VAGABOND.Item.Alchemical.FIELDS.baseCost.label'}}</label>
          <div class='grid grid-3col gap-8'>
            <div class='cost-field'>
              <label class='resource-label'>Gold</label>
              <input
                type='number'
                name='system.baseCost.gold'
                value='{{system.baseCost.gold}}'
                step="1"
                min='0'
                data-dtype='Number'
              />
            </div>
            <div class='cost-field'>
              <label class='resource-label'>Silver</label>
              <input
                type='number'
                name='system.baseCost.silver'
                value='{{system.baseCost.silver}}'
                step="1"
                min='0'
                data-dtype='Number'
              />
            </div>
            <div class='cost-field'>
              <label class='resource-label'>Copper</label>
              <input
                type='number'
                name='system.baseCost.copper'
                value='{{system.baseCost.copper}}'
                step="1"
                min='0'
                data-dtype='Number'
              />
            </div>
          </div>
        </div>
      {{/if}}

      {{! ===== RELIC-SPECIFIC FIELDS ===== }}
      {{#if (eq system.equipmentType 'relic')}}
        {{! Lore }}
        <div class='form-group'>
          <label class='resource-label'>{{localize 'VAGABOND.Item.Relic.FIELDS.lore.label'}}</label>
          <input
            type='text'
            name='system.lore'
            value='{{system.lore}}'
            data-dtype='String'
            placeholder='Enter the relic lore and history...'
          />
        </div>

        {{! Value (Cost) }}
        <div class='form-group'>
          <label class='resource-label'>{{localize 'VAGABOND.Item.Relic.FIELDS.baseCost.label'}}</label>
          <div class='grid grid-3col gap-8'>
            <div class='cost-field'>
              <label class='resource-label'>Gold</label>
              <input
                type='number'
                name='system.baseCost.gold'
                value='{{system.baseCost.gold}}'
                min='0'
                data-dtype='Number'
              />
            </div>
            <div class='cost-field'>
              <label class='resource-label'>Silver</label>
              <input
                type='number'
                name='system.baseCost.silver'
                value='{{system.baseCost.silver}}'
                min='0'
                data-dtype='Number'
              />
            </div>
            <div class='cost-field'>
              <label class='resource-label'>Copper</label>
              <input
                type='number'
                name='system.baseCost.copper'
                value='{{system.baseCost.copper}}'
                min='0'
                data-dtype='Number'
              />
            </div>
          </div>
        </div>
      {{/if}}

      {{! ===== UNIVERSAL FIELDS (ALL EQUIPMENT) ===== }}

      {{! Damage Type and Amount Row (Universal) - only for armor and gear (weapons/alchemicals/relics have their own) }}
      {{#if (or (eq system.equipmentType 'armor') (eq system.equipmentType 'gear'))}}
        <div class='form-group'>
          <label class='resource-label'>Damage / Healing</label>
        <div class='grid grid-2col gap-8'>
          <div class='damage-type-field'>
            <label class='resource-label'>Type</label>
            {{> "systems/vagabond/templates/shared/damage-type-select.hbs"
                name="system.damageType"
                selected=system.damageType
                includeNone=true
                config=config}}
          </div>
          <div class='damage-amount-field'>
            <label class='resource-label'>Amount</label>
            <input
              type='text'
              name='system.damageAmount'
              value='{{system.damageAmount}}'
              data-dtype='String'
              placeholder='e.g., 2d6, 1d8+2'
            />
          </div>
        </div>

        {{! Exploding Dice Configuration }}
        <div class='form-group'>
          <label class='resource-label'>Exploding Dice</label>
          <div class='grid grid-2col gap-8'>
            <div class='explode-checkbox-field'>
              <label class='checkbox-label'>
                <input
                  type='checkbox'
                  name='system.canExplode'
                  {{#if system.canExplode}}checked{{/if}}
                  data-dtype='Boolean'
                />
                <span>Can Explode</span>
              </label>
            </div>
            <div class='explode-values-field'>
              <label class='resource-label'>Explode On (comma-separated)</label>
              <input
                type='text'
                name='system.explodeValues'
                value='{{system.explodeValues}}'
                data-dtype='String'
                placeholder='e.g., 1,4'
                {{#unless system.canExplode}}disabled{{/unless}}
              />
            </div>
          </div>
        </div>
        </div>
      {{/if}}

      {{! Metal, Slots, and Quantity Row }}
      {{#unless (or (eq system.equipmentType 'relic') (eq system.equipmentType 'alchemical'))}}
        <div class='form-group'>
          <label class='resource-label'>Equipment Details</label>
          <div class='grid grid-3col gap-8'>
            <div class='metal-field'>
              <label class='resource-label'>Metal</label>
              <select name='system.metal' data-dtype='String'>
                {{!-- 1. Handle "None" explicitly if it's not in your main type list --}}
                <option value="none" {{#if (eq system.metal 'none')}}selected{{/if}}>None</option>
                
                {{!-- 2. Iterate dynamically over the config --}}
                {{#each config.metalTypes as |label key|}}
                  <option 
                    value="{{key}}" 
                    {{#if (eq ../system.metal key)}}selected{{/if}}
                    {{!-- FIXED: Nested lookup to get .effect from the metalData object --}}
                    title="{{localize (lookup (lookup ../config.metalData key) 'effect')}}"
                  >
                    {{localize label}}
                  </option>
                {{/each}}
              </select>
            </div>
            <div class='slots-field'>
              <label class='resource-label'>Base Slots</label>
              <input
                type='number'
                name='system.baseSlots'
                value='{{system.baseSlots}}'
                data-dtype='Number'
              />
            </div>
            <div class='quantity-field'>
              <label class='resource-label'>Quantity</label>
              <input
                type='number'
                name='system.quantity'
                value='{{system.quantity}}'
                min='0'
                data-dtype='Number'
              />
            </div>
          </div>
          <div class='metal-effect-text'>{{system.metalEffect}}</div>
        </div>
      {{/unless}}

      {{! Slots and Quantity for Relics (no metal) }}
      {{#if (eq system.equipmentType 'relic')}}
        <div class='form-group'>
          <label class='resource-label'>Equipment Details</label>
          <div class='grid grid-2col gap-8'>
            <div class='slots-field'>
              <label class='resource-label'>Base Slots</label>
              <input
                type='number'
                name='system.baseSlots'
                value='{{system.baseSlots}}'
                data-dtype='Number'
              />
            </div>
            <div class='quantity-field'>
              <label class='resource-label'>Quantity</label>
              <input
                type='number'
                name='system.quantity'
                value='{{system.quantity}}'
                min='0'
                data-dtype='Number'
              />
            </div>
          </div>
        </div>
      {{/if}}

      {{! Cost Section (3 Columns) - not for relics or alchemicals, they have their own }}
      {{#unless (or (eq system.equipmentType 'relic') (eq system.equipmentType 'alchemical'))}}
        <div class='form-group'>
          <label class='resource-label'>Base Cost <small>(before metal multiplier)</small></label>
          <div class='grid grid-3col gap-8'>
            <div class='cost-field'>
              <label class='resource-label'>Gold</label>
              <input
                type='number'
                name='system.baseCost.gold'
                value='{{system.baseCost.gold}}'
                min='0'
                data-dtype='Number'
              />
            </div>
            <div class='cost-field'>
              <label class='resource-label'>Silver</label>
              <input
                type='number'
                name='system.baseCost.silver'
                value='{{system.baseCost.silver}}'
                min='0'
                data-dtype='Number'
              />
            </div>
            <div class='cost-field'>
              <label class='resource-label'>Copper</label>
              <input
                type='number'
                name='system.baseCost.copper'
                value='{{system.baseCost.copper}}'
                min='0'
                data-dtype='Number'
              />
            </div>
          </div>
        </div>
      {{/unless}}

      {{! Consumable Configuration }}
      <div class='form-group'>
        <label class='resource-label'>Consumable Configuration</label>
        <div class='grid grid-1col gap-8'>
          <div class='consumable-checkbox-field'>
            <label class='checkbox-label'>
              <input
                type='checkbox'
                name='system.isConsumable'
                {{#if system.isConsumable}}checked{{/if}}
                data-dtype='Boolean'
              />
              <span>Consumable (reduces quantity on use)</span>
            </label>
          </div>
          <div class='linked-consumable-field'>
            <label class='resource-label'>Linked Consumable (optional)</label>
            <select name='system.linkedConsumable' data-dtype='String'>
              <option value=''>None</option>
              {{#each actorConsumableItems as |consumable|}}
                <option value='{{consumable.id}}' {{#if (eq ../system.linkedConsumable consumable.id)}}selected{{/if}}>
                  {{consumable.name}} ({{consumable.system.quantity}} remaining)
                </option>
              {{/each}}
            </select>
            <small class='field-hint'>When this item is used, it will consume the linked item instead</small>
          </div>
        </div>
      </div>

      {{! Calculated Properties Display - not needed for relics or alchemicals }}
      {{#unless (or (eq system.equipmentType 'relic') (eq system.equipmentType 'alchemical'))}}
        <div class='form-group'>
          <label class='resource-label'>Calculated Properties</label>
          <div class='calculated-properties'>
            <div class='calculated-item'>
              <span class='calc-label'>Final Slots:</span>
              <span class='calc-value'>{{system.slots}}</span>
            </div>
            <div class='calculated-item'>
              <span class='calc-label'>Final Cost:</span>
              <span class='calc-value'>{{system.costDisplay}}</span>
            </div>
          </div>
        </div>
      {{/unless}}
    </div>
  {{/if}}
</section>
