<section class="tab details {{tab.cssClass}} perk-details-wrapper" data-group="primary" data-tab="details">

    {{!-- 1. Description (Full Width) --}}
    <div class="perk-section description-section">
        <label class="section-header">
            <i class="fas fa-book-open"></i> {{localize 'VAGABOND.Item.Perk.FIELDS.description.label'}}
        </label>
        <div class="editor-container">
            {{#if editable}}
                <prose-mirror name="system.description" data-document-uuid="{{item.uuid}}" value="{{system.description}}" collaborate="true" toggled="true">
                    {{{enriched.description}}}
                </prose-mirror>
            {{else}}
                <div class="editor-content">{{{enriched.description}}}</div>
            {{/if}}
        </div>
    </div>

    <hr class="perk-divider">

    {{!-- 2. Prerequisites Grid (Two Columns) --}}
    <div class="perk-prerequisites-grid">

        {{!-- LEFT COLUMN: Stats & Skills --}}
        <div class="perk-col">
            
            {{!-- Stats --}}
            <div class="prereq-group">
                <div class="group-header">
                    <span><i class="fas fa-chart-bar"></i> {{localize 'VAGABOND.Item.Perk.FIELDS.prerequisites.stats.label'}}</span>
                    <a class="add-btn-mini" data-action="addStatPrerequisite"><i class="fas fa-plus"></i></a>
                </div>
                <div class="prereq-list">
                    {{#each item.system.prerequisites.stats as |stat index|}}
                    <div class="prereq-row">
                        <select name="system.prerequisites.stats.{{index}}.stat">
                            <option value="might" {{#if (eq stat.stat 'might')}}selected{{/if}}>{{localize 'VAGABOND.Stat.Might.abbr'}}</option>
                            <option value="dexterity" {{#if (eq stat.stat 'dexterity')}}selected{{/if}}>{{localize 'VAGABOND.Stat.Dexterity.abbr'}}</option>
                            <option value="awareness" {{#if (eq stat.stat 'awareness')}}selected{{/if}}>{{localize 'VAGABOND.Stat.Awareness.abbr'}}</option>
                            <option value="reason" {{#if (eq stat.stat 'reason')}}selected{{/if}}>{{localize 'VAGABOND.Stat.Reason.abbr'}}</option>
                            <option value="presence" {{#if (eq stat.stat 'presence')}}selected{{/if}}>{{localize 'VAGABOND.Stat.Presence.abbr'}}</option>
                            <option value="luck" {{#if (eq stat.stat 'luck')}}selected{{/if}}>{{localize 'VAGABOND.Stat.Luck.abbr'}}</option>
                        </select>
                        <input type="number" name="system.prerequisites.stats.{{index}}.value" value="{{stat.value}}" min="1" max="10" placeholder="Val">
                        <a class="delete-btn" data-action="removeStatPrerequisite" data-index="{{index}}"><i class="fas fa-trash"></i></a>
                    </div>
                    {{else}}
                    <div class="empty-placeholder">{{localize "VAGABOND.None"}}</div>
                    {{/each}}
                </div>
            </div>

            {{!-- Trained Skills --}}
            <div class="prereq-group">
                <div class="group-header">
                    <span><i class="fas fa-graduation-cap"></i> {{localize 'VAGABOND.Item.Perk.FIELDS.prerequisites.trainedSkills.label'}}</span>
                    <a class="add-btn-mini" data-action="addTrainedSkillPrerequisite"><i class="fas fa-plus"></i></a>
                </div>
                <div class="prereq-list">
                    {{#each item.system.prerequisites.trainedSkills as |skill index|}}
                    <div class="prereq-row">
                        <select name="system.prerequisites.trainedSkills.{{index}}">
                            <optgroup label="Skills">
                                <option value="arcana" {{#if (eq skill 'arcana')}}selected{{/if}}>{{localize 'VAGABOND.Skills.Arcana'}}</option>
                                <option value="craft" {{#if (eq skill 'craft')}}selected{{/if}}>{{localize 'VAGABOND.Skills.Craft'}}</option>
                                <option value="medicine" {{#if (eq skill 'medicine')}}selected{{/if}}>{{localize 'VAGABOND.Skills.Medicine'}}</option>
                                <option value="brawl" {{#if (eq skill 'brawl')}}selected{{/if}}>{{localize 'VAGABOND.Skills.Brawl'}}</option>
                                <option value="finesse" {{#if (eq skill 'finesse')}}selected{{/if}}>{{localize 'VAGABOND.Skills.Finesse'}}</option>
                                <option value="sneak" {{#if (eq skill 'sneak')}}selected{{/if}}>{{localize 'VAGABOND.Skills.Sneak'}}</option>
                                <option value="detect" {{#if (eq skill 'detect')}}selected{{/if}}>{{localize 'VAGABOND.Skills.Detect'}}</option>
                                <option value="mysticism" {{#if (eq skill 'mysticism')}}selected{{/if}}>{{localize 'VAGABOND.Skills.Mysticism'}}</option>
                                <option value="survival" {{#if (eq skill 'survival')}}selected{{/if}}>{{localize 'VAGABOND.Skills.Survival'}}</option>
                                <option value="influence" {{#if (eq skill 'influence')}}selected{{/if}}>{{localize 'VAGABOND.Skills.Influence'}}</option>
                                <option value="leadership" {{#if (eq skill 'leadership')}}selected{{/if}}>{{localize 'VAGABOND.Skills.Leadership'}}</option>
                                <option value="performance" {{#if (eq skill 'performance')}}selected{{/if}}>{{localize 'VAGABOND.Skills.Performance'}}</option>
                            </optgroup>
                            <optgroup label="Weapon Skills">
                                <option value="melee" {{#if (eq skill 'melee')}}selected{{/if}}>{{localize 'VAGABOND.WeaponSkills.Melee'}}</option>
                                <option value="ranged" {{#if (eq skill 'ranged')}}selected{{/if}}>{{localize 'VAGABOND.WeaponSkills.Ranged'}}</option>
                            </optgroup>
                        </select>
                        <a class="delete-btn" data-action="removeTrainedSkillPrerequisite" data-index="{{index}}"><i class="fas fa-trash"></i></a>
                    </div>
                    {{else}}
                    <div class="empty-placeholder">{{localize "VAGABOND.None"}}</div>
                    {{/each}}
                </div>
            </div>

        </div>

        {{!-- RIGHT COLUMN: Spells & Resources --}}
        <div class="perk-col">

            {{!-- Spells --}}
            <div class="prereq-group">
                <div class="group-header">
                    <span><i class="fas fa-magic"></i> {{localize 'VAGABOND.Item.Perk.FIELDS.prerequisites.spells.label'}}</span>
                    <a class="add-btn-mini" data-action="addSpellPrerequisite"><i class="fas fa-plus"></i></a>
                </div>
                <div class="prereq-list">
                    {{!-- "Has Any Spell" Checkbox --}}
                    <div class="prereq-row">
                        <label class="checkbox-label">
                            <input type="checkbox" name="system.prerequisites.hasAnySpell" {{checked item.system.prerequisites.hasAnySpell}}>
                            {{localize 'VAGABOND.Item.Perk.HasAnySpell'}}
                        </label>
                    </div>

                    {{!-- Specific Spell Prerequisites --}}
                    {{#each spellPrerequisites as |prereq|}}
                    <div class="prereq-row">
                        <select name="system.prerequisites.spells.{{prereq.index}}">
                            <option value="">{{localize 'VAGABOND.Item.Perk.SelectSpell'}}</option>
                            {{#each prereq.availableSpells as |spell|}}
                                <option value="{{spell.uuid}}" {{#if spell.isSelected}}selected{{/if}}>
                                    {{spell.name}} ({{spell.packLabel}})
                                </option>
                            {{/each}}
                        </select>
                        <a class="delete-btn" data-action="removeSpellPrerequisite" data-index="{{prereq.index}}"><i class="fas fa-trash"></i></a>
                    </div>
                    {{else}}
                    {{#unless item.system.prerequisites.hasAnySpell}}
                    <div class="empty-placeholder">{{localize "VAGABOND.None"}}</div>
                    {{/unless}}
                    {{/each}}
                </div>
            </div>

            {{!-- Resources --}}
            <div class="prereq-group">
                <div class="group-header">
                    <span><i class="fas fa-coins"></i> {{localize 'VAGABOND.Item.Perk.FIELDS.prerequisites.resources.label'}}</span>
                    <a class="add-btn-mini" data-action="addResourcePrerequisite"><i class="fas fa-plus"></i></a>
                </div>
                <div class="prereq-list">
                    {{#each item.system.prerequisites.resources as |resource index|}}
                    <div class="prereq-row">
                        <select name="system.prerequisites.resources.{{index}}.resourceType">
                            <option value="">{{localize 'VAGABOND.Item.Perk.SelectResource'}}</option>
                            <option value="maxMana" {{#if (eq resource.resourceType 'maxMana')}}selected{{/if}}>{{localize 'VAGABOND.ResourceTypes.MaxMana'}}</option>
                            <option value="manaPerCast" {{#if (eq resource.resourceType 'manaPerCast')}}selected{{/if}}>{{localize 'VAGABOND.ResourceTypes.ManaPerCast'}}</option>
                            <option value="wealth" {{#if (eq resource.resourceType 'wealth')}}selected{{/if}}>{{localize 'VAGABOND.ResourceTypes.Wealth'}}</option>
                            <option value="inventorySlots" {{#if (eq resource.resourceType 'inventorySlots')}}selected{{/if}}>{{localize 'VAGABOND.ResourceTypes.InventorySlots'}}</option>
                            <option value="speed" {{#if (eq resource.resourceType 'speed')}}selected{{/if}}>{{localize 'VAGABOND.ResourceTypes.Speed'}}</option>
                            <option value="maxHP" {{#if (eq resource.resourceType 'maxHP')}}selected{{/if}}>{{localize 'VAGABOND.ResourceTypes.MaxHP'}}</option>
                            <option value="currentLuck" {{#if (eq resource.resourceType 'currentLuck')}}selected{{/if}}>{{localize 'VAGABOND.ResourceTypes.CurrentLuck'}}</option>
                        </select>
                        <input type="number" name="system.prerequisites.resources.{{index}}.minimum" value="{{resource.minimum}}" min="0" placeholder="Min" style="width: 60px;">
                        <a class="delete-btn" data-action="removeResourcePrerequisite" data-index="{{index}}"><i class="fas fa-trash"></i></a>
                    </div>
                    {{else}}
                    <div class="empty-placeholder">{{localize "VAGABOND.None"}}</div>
                    {{/each}}
                </div>
            </div>

        </div>
    </div>
</section>